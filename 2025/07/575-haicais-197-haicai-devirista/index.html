<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8">
    <title>575 Haicais 197 - Haicai Devirista</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/css/style.css">
    <style>
      body.locked {
        overflow: hidden;
      }
      body.locked .nav-links,
      body.locked .nav-burger {
        display: none;
      }
      #gate {
        position: fixed;
        inset: 0;
        background: rgba(255, 255, 255, 0.97);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 9999;
      }
      #gate form {
        max-width: 420px;
        width: 100%;
        padding: 2rem;
        display: flex;
        flex-direction: column;
        gap: 1rem;
        position: relative;
      }
      #gate h1 {
        text-align: center;
        font-weight: normal;
      }
      #gate p {
        text-align: center;
        font-size: 0.9rem;
        opacity: 0.8;
      }
      #gate input,
      #gate textarea {
        font-size: 1rem;
        padding: 0.6rem;
        width: 100%;
      }
      #gate button {
        background: #111;
        color: #fff;
        border: none;
        padding: 0.6rem;
        cursor: pointer;
      }
      #cancel-btn {
        background: transparent;
        color: #111;
        border: 1px solid #111;
        margin-top: 0.5rem;
        cursor: pointer;
      }
      #wait-message {
        font-size: 0.85rem;
        text-align: center;
        color: #555;
        display: none;
      }
    </style>
  </head>
  <body class="locked">
    <header class="site-header">
      <nav class="nav">
        <div class="nav-inner">
          <a href="/" class="site-title">ameopoema</a>
          <ul class="nav-links">
            <li>
              <a href="/">Início</a>
            </li>
            <li>
              <a href="/haicais/">Haicais</a>
            </li>
            <li>
              <a href="/poesias/">Poesias</a>
            </li>
            <li>
              <a href="/textos/">Textos</a>
            </li>
            <li>
              <a href="/print/">Livros</a>
            </li>
            <li>
              <a href="#" onclick="openGate(event)">Contato</a>
            </li>
          </ul>
        </div>
      </nav>
    </header>
    <div id="gate">
      <form id="gate-form" novalidate>
        <h1 class="site-title">ameopoema</h1>
        <p>Palavras abrem portas. Deixe sua mensagem :)</p>
        <input type="text" id="name" placeholder="Seu nome">
        <input type="email" id="email" placeholder="Seu email">
        <textarea id="message" rows="5" placeholder="Escreva algo para entrar"></textarea>
        <input type="text" id="website" style="display:none">
        <button type="submit">Entrar</button>
        <button id="cancel-btn" type="button" style="display:none" onclick="cancelGate()">Cancelar</button>
        <div id="wait-message">
          <p class="wait-text"></p>
        </div>
        <iframe name="hidden_iframe" style="display:none;"></iframe>
      </form>
    </div>
    <main class="site-main">
      
<article>
  <h1>575 Haicais 197 - Haicai Devirista
    <time datetime="Thu Jul 17 2025 14:40:00 GMT+0000 (Coordinated Universal Time)">17/07/2025</time>
  </h1>
  <p></p>
  Pra quem se muda<br><div>O lar é o caminho</div><div>Muda-se quem é</div>
</article>
    </main>
    <footer class="site-footer">
      <p id="reset-storage">
        © 2026 Ameopoema
      </p>
    </footer>
    <script>
      const FORM_ACTION = "https://docs.google.com/forms/d/e/1FAIpQLScItpjJxsc4GOYWayWwVU-CEyxrwA_7FQtRDO_9ZB1r8rh-0w/formResponse";
      const MIN_INTERVAL = 60 * 1000;
      const STORAGE_KEY = "ameopoema_last_submit";
      const SESSION_KEY = "ameopoema_unlocked";
      const waitBox = document.getElementById("wait-message");
      const waitText = waitBox.querySelector(".wait-text");
      const cancelBtn = document.getElementById("cancel-btn");
      const spamWords = [
        "viagra",
        "bitcoin",
        "crypto",
        "casino",
        "ganhe dinheiro",
        "free money",
        "porn"
      ];
      // Se já desbloqueou nesta sessão, abre direto
      if (sessionStorage.getItem(SESSION_KEY)) {
        unlock();
      }
      document.getElementById("gate-form").addEventListener("submit", function (e) {
        e.preventDefault();
        hideWait();
        if (document.getElementById("website").value) 
          return;
        
        const name = get("name");
        const email = get("email");
        const message = get("message");
        if (! name || ! email || ! message) 
          return showWait("Todos os campos precisam ser preenchidos. <br>Deixe sua mensagem. <br> Nos conte, você é um robô?");
        
        if (!validEmail(email)) 
          return showWait("O email não parece válido.");
        
        if (looksLikeSpam(message)) 
          return showWait("Essa mensagem parece automática demais.");
        
        const last = localStorage.getItem(STORAGE_KEY);
        const now = Date.now();
        if (last && now - last < MIN_INTERVAL) {
          return showWait("A poesia habita no silêncio entre os versos.<br>Tente novamente daqui a 1 minuto.");
        }
        const form = document.createElement("form");
        form.method = "POST";
        form.action = FORM_ACTION;
        form.target = "hidden_iframe";
        form.innerHTML = `
      <input type="hidden" name="entry.409672853" value="${
          escapeHTML(name)
        }">
      <input type="hidden" name="entry.2040541815" value="${
          escapeHTML(email)
        }">
      <input type="hidden" name="entry.739396940" value="${
          escapeHTML(message)
        }">
    `;
        document.body.appendChild(form);
        form.submit();
        document.body.removeChild(form);
        localStorage.setItem(STORAGE_KEY, now.toString());
        sessionStorage.setItem(SESSION_KEY, "1"); // marca sessão
        unlock();
      });
      function get(id) {
        return document
          .getElementById(id)
          .value
          .trim();
      }
      function validEmail(email) {
        return /^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/.test(email);
      }
      function looksLikeSpam(text) {
        if (text.length < 8) 
          return true;
        
        if ((text.match(/https?:\/\//g) || []).length > 2) 
          return true;
        
        if (/([a-zA-Z])\1{7,}/.test(text)) 
          return true;
        
        const lower = text.toLowerCase();
        return spamWords.some(w => lower.includes(w));
      }
      function showWait(msg) {
        waitText.innerHTML = msg;
        waitBox.style.display = "block";
      }
      function hideWait() {
        waitBox.style.display = "none";
      }
      function unlock() {
        document
          .getElementById("gate")
          .style
          .display = "none";
        document
          .body
          .classList
          .remove("locked");
      }
      function openGate(e) {
        e.preventDefault();
        if (!sessionStorage.getItem(SESSION_KEY)) 
          return;
        
        // só abre se já enviou
        document
          .getElementById("gate")
          .style
          .display = "flex";
        document
          .body
          .classList
          .add("locked");
        cancelBtn.style.display = "block"; // mostra botão cancelar
      }
      function cancelGate() {
        document
          .getElementById("gate")
          .style
          .display = "none";
        document
          .body
          .classList
          .remove("locked");
        cancelBtn.style.display = "none";
        window.location.href = "/"; // volta para home
      }
      function escapeHTML(str) {
        return str
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;")
          .replace(/"/g, "&quot;")
          .replace(/'/g, "&#039;");
      }
      const resetBtn = document.getElementById("reset-storage");
      resetBtn.addEventListener("click", () => {
        localStorage.removeItem(STORAGE_KEY);
        sessionStorage.removeItem(SESSION_KEY);
        // abre o gate
        document
          .getElementById("gate")
          .style
          .display = "flex";
        document
          .body
          .classList
          .add("locked");
        cancelBtn.style.display = "none"; // botão cancelar não aparece na primeira mensagem
      });
    </script>
  </body>
</html>